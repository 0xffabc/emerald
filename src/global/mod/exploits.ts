import { Intermediate } from "../../gui/intermediate";
import { WeaponMerger } from "../../hack/exploits/weapon-merger";
import { World } from "../../world/world";
import { Timer } from "../lib/timer";

export class Exploits {
  public static WeaponMerger = class {
    public static instance: WeaponMerger | null = null;

    /**
     * @name unlink
     * @description Destroys the WeaponMerger instance
     */
    public static unlink() {
      if (this.instance) {
        this.instance.destroy();
        this.instance = null;
      }
    }

    /**
     * @name mergeWeapons
     * @description Merges weapons from a string representation
     * @param weapons String representation of weapons to merge
     * @returns WeaponMerger instance
     */
    public static mergeWeapons(weapons: string) {
      this.unlink();

      this.instance = WeaponMerger.fromString(weapons);

      Intermediate.notification(
        "Merged weapons: " +
          this.instance.weapons.map((e) => e.toString()).join(", "),
      );

      return this.instance;
    }
  };

  public static BackTrack = class {
    public static Delay = 0;
  };

  public static RandomHP = new Timer()
    .withTimeout(100)
    .withName("RandomHP")
    .withCallback(() => {
      World.PlayerManager.players.forEach((player) => {
        player.setHealth(Math.random() * 100);
      });
    })
    .build();

  public static InfiniteWeapon = new Timer()
    .withTimeout(1000)
    .withName("InfiniteWeapon")
    .withCallback(() => {
      if (!World.myPlayer?.weapon) {
        this.InfiniteWeapon.stop();

        return Intermediate.notification("No weapon equipped");
      }

      World.myPlayer.applyInfiniteWeaponExploit(World.myPlayer.weapon!!);
    })
    .build();

  public static RapidFire = new Timer()
    .withTimeout(200)
    .withName("RapidFire")
    .withCallback(() => {
      if (!World.myPlayer?.weapon) {
        this.RapidFire.stop();

        return Intermediate.notification("No weapon equipped");
      }

      World.myPlayer.applyRapidFireExploit(World.myPlayer.weapon!!);
    })
    .build();

  public static InvisibleHit = new Timer()
    .withTimeout(1000)
    .withName("InvisibleHit")
    .withCallback(() => {
      if (!World.myPlayer?.weapon) {
        this.InvisibleHit.stop();

        return Intermediate.notification("No weapon equipped");
      }

      World.myPlayer.applyInvisibleHitExploit(World.myPlayer.weapon!!);
    })
    .build();

  /**
   * @name Immortality
   * @description Applies immortality exploit to your player
   * Once applied, you're incapable of dying and respawning
   * So if you get stuck in a wall, you'll get softlocked
   */
  public static Immortality() {
    World.myPlayer?.applyImmortalityExploit();
  }
}
