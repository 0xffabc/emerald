import SocketController from "../../socket/controller/controller";
import type { Player } from "../../world/objects/player";
import { Weapon } from "../../world/objects/weapon";
import { CentralGun } from "../../world/weapons/central-gun";
import { World } from "../../world/world";
import type { Exploit } from "../exploit";

export class RapidFireExploit implements Exploit {
  name = "Rapid Fire Exploit";
  description = "Allows the player to fire bullets rapidly";

  weapon: Weapon;
  player: Player;

  constructor(weapon: Weapon, player: Player) {
    this.weapon = weapon;
    this.player = player;
  }

  send() {
    if (!World.MouseManager.isRightDown()) return;

    const central = new CentralGun();

    if (this.player.weapon !== central) {
      this.player.setWeapon(central);
    }

    if (this.player.weapon !== this.weapon) {
      this.player.setWeapon(this.weapon);
    }

    SocketController.simulateServerPacket(
      Array.from(this.weapon.toFireEvent(this.player.id)),
    );
  }
}
